<!DOCTYPE html>
<html>
<meta charset="utf-8">

<head>
<script src="http://d3js.org/d3.v4.js"></script>
<script src="http://d3js.org/queue.v1.min.js"></script>
<script src="http://d3js.org/topojson.v2.min.js"></script>
<link rel="stylesheet" type="text/css" href="index.css">
</head>

<body>
<div class='page-wrapper'>
  <div class='row'>
    <h1 class="title-style">COVID-19 Statistics (March 2020)</h1>
  </div>
  <div class='row'>
    <div class='column'>
	<div id="confirmedValue" class="monospace"><b class="thicker">Confirmed Cases</b><br><br></div>
    </div>
    <div class='column'>
        <div id="deathsValue" class="monospace"><b class="thicker">Death Cases</b><br><br></div>
    </div>
    <div class='column'>
        <div id="recoveredValue" class="monospace"><b class="thicker">Recovered Cases</b><br><br></div>
    </div>
  </div>

 <div class='row'>
    <div class='large-column'>
	 <div class="tooltip"></div>
      <div id="map" class="item-map-style"></div>
    </div>
    
  </div>
<object data="radial.html" width="800" height="900"></object>
</div>

</body>

<script>
d3.csv("covid-19 dataset.csv", function(data){

    var totalConfirmed = [d3.sum(data.map(function(d){
		return d.confirmed}))];

    //once amal update the dataset, the sum must be based on the final week of march (week 4)
    //var totalConfirmed = [d3.sum(data.map(function(d){(if d.week == '4'){
    //return d.confirmed}}))];

    console.log(totalConfirmed);

	d3.select('#confirmedValue')
    .selectAll('p1')
    .data(totalConfirmed)
    .enter()
    .append('p1')
    .text(function(d){
		return d;})

    var totalDeaths = [d3.sum(data.map(function(d){
		return d.deaths}))];

    //once amal update the dataset, the sum must be based on the final week of march (week 4)
    //var totalConfirmed = [d3.sum(data.map(function(d){(if d.week == '4'){
    //return d.confirmed}}))];

	d3.select('#deathsValue')
    .selectAll('p1')
    .data(totalDeaths)
    .enter()
    .append('p1')
    .text(function(d){
		return d;})

    var totalRecovered = [d3.sum(data.map(function(d){
    return d.recovered}))];

    //once amal update the dataset, the sum must be based on the final week of march (week 4)
    //var totalRecovered = [d3.sum(data.map(function(d){(if d.week == '4'){
    //return d.recovered}}))];

  d3.select('#recoveredValue')
    .selectAll('p1')
    .data(totalRecovered)
    .enter()
    .append('p1')
    .text(function(d){
    return d;})

	});
</script>

<script>
  var format = d3.format(",");

  //size of svg to contained the d3 map
  var margin = {top: 5, right: 5, bottom: 5, left: 5},
              width = 1250 - margin.left - margin.right,
              height = 600 - margin.top - margin.bottom;


  //initialize toopltip
  var tooltip = d3.select("div.tooltip");

  //initialize projection for d3 map scaling using geoEquirectangular format
  var projection = d3.geoEquirectangular()
                    .center([0, -25])
                    .scale(200)
                    .translate( [width / 2, height / 1.5]);


  //initialize path variable for d3 map
  var path = d3.geoPath().projection(projection);

  //initialize and append svg on id map
  var svg = d3.select("#map")
              .append("svg")
              .attr("width", width)
              .attr("height", height)
              .append('g');


  //using d3 queue library to load to datasets
  d3.queue()
    .defer(d3.json,"world-110m.json")
    .defer(d3.csv, "covid-19 dataset.csv")
    .await(ready);
    function ready(error, world, dataset)
  {
      if (error) throw error;

      console.log(dataset);

      //variable extracting features of world map based on loaded topojson
      var countries = topojson.feature( world, world.objects.countries).features;

      //variables to store name of country and the required values
      var name = [];
      var confirmed = [];
      var deaths = [];
      var recovered = [];

      //function to get country name based on matching country id between the two loaded dataset
      dataset.forEach(function(d){
        return name[d.id] = d.name;
      });

      //function to get confirmed cases values based on matching country id between the two loaded dataset
      dataset.forEach(function(d){
        if(d.week == '4'){return confirmed[d.id] = d.confirmed;}
      });

      //function to get deaths values based on matching country id between the two loaded dataset
      dataset.forEach(function(d){
        if(d.week == '4'){return deaths[d.id] = d.deaths;}
      });

      //function to get recovered values based on matching country id between the two loaded dataset
      dataset.forEach(function(d){
        if(d.week == '4'){return recovered[d.id] = d.recovered;}
      });

      svg.selectAll("countries")
      .data(countries)
      .enter().append("path")
      .attr("class", "countries")
      .attr("d", path)
      //mouse function enabling interaction of map via tooltip
      .on("mouseover",function(d,i){
          d3.select(this).classed("hover", true)
          tooltip.classed("hidden", false)
      })
      .on("mousemove",function(d){
          tooltip.style("top", (d3.event.pageY) + "px")
                 .style("left", (d3.event.pageX + 10) + "px")
                 //show the name and values on tooltip
                 .html("<b style='font-size:16px'>" + name[d.id] + "</b>" +
                      "<br/>"+ "Confirmed Cases:" + "<b>"+ confirmed[d.id]+ "</b>" +
                      "<br/>"+ "Deaths:" + "<b style='color:red'>" + deaths[d.id]+ "</b>" +
                      "<br/>"+ "Recovered:" + "<b style='color:green'>" + recovered[d.id]+ "</b>")
      })
      .on("mouseout",function(d,i){
          d3.select(this).classed("hover", false)
          tooltip.classed("hidden", true)
      })
      //d3 zooming function to enable zooming of the map
      .call(d3.zoom().scaleExtent([1, 8]).on('zoom', function () {
        svg.attr("transform", d3.event.transform)
      }))
      //disable panning ability from d3 zoom
      .on("mousedown.zoom", null)
      .on("touchstart.zoom", null)
      .on("touchmove.zoom", null)
      .on("touchend.zoom", null);


      //appending path to svg to draw borders based on data from topojson dataset
      svg.append("path")
          .attr( "class", "country-borders" )
          .attr("d", path(topojson.mesh( world, world.objects.countries, function( a, b)
          {
              return a !== b;
          })));

  };
</script>
</html>
